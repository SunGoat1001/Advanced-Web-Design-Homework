<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Bảng sản phẩm từ API</title>
    <style>
        table {
            border-collapse: collapse;
            width: 60%;
            margin: 20px auto;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f2f2f2;
        }
    </style>
</head>

<body>
    <h2 style="text-align:center">Danh sách sản phẩm từ API</h2>
    <button id="addProductBtn" style="display:block;margin:10px auto;">Thêm sản phẩm</button>
    <table id="productTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Avatar</th>
                <th>Name</th>
                <th>Price</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dữ liệu sẽ được render ở đây -->
        </tbody>
    </table>

    <!-- Form ẩn để thêm/sửa sản phẩm -->
    <div id="productFormModal"
        style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);align-items:center;justify-content:center;">
        <form id="productForm"
            style="background:#fff;padding:20px;border-radius:8px;min-width:300px;position:relative;">
            <h3 id="formTitle">Thêm sản phẩm</h3>
            <input type="hidden" id="productId">
            <div>
                <label>Avatar:</label><br>
                <div class="img"></div>
                <input type="file" accept="image/*" class="local" id="productImg">
            </div>
            <div>
                <label>Name:</label><br>
                <input type="text" id="productName" style="width:100%">
            </div>
            <div>
                <label>Price:</label><br>
                <input type="number" id="productPrice" style="width:100%">
            </div>
            <div style="margin-top:10px;text-align:right;">
                <button type="submit" id="saveProductBtn">Lưu</button>
                <button type="button" id="cancelProductBtn">Huỷ</button>
            </div>
        </form>
    </div>

    <!-- Modal xác nhận xoá -->
    <div id="confirmDeleteModal"
        style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);align-items:center;justify-content:center;">
        <div style="background:#fff;padding:20px;border-radius:8px;min-width:300px;position:relative;">
            <p>Bạn có chắc muốn xoá sản phẩm này?</p>
            <div style="text-align:right;">
                <button id="confirmDeleteBtn">Xoá</button>
                <button id="cancelDeleteBtn">Huỷ</button>
            </div>
        </div>
    </div>

    <script src="handleUploadImg.js"></script>
    <script src="handleAPI.js"></script>
    <script src="handleModal.js"></script>
    <script>
        const apiURL = 'https://68d39cb6214be68f8c667d39.mockapi.io/products';
        let products = [];
        let deleteId = null;

        function renderTable(data) {
            const tbody = document.querySelector('#productTable tbody');
            tbody.innerHTML = '';
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.id}</td>
                    <td><img src="${item.img}" alt="" style="width: 50px; height: 50px; object-fit: cover;"></td>
                    <td>${item.name}</td>
                    <td>$${item.price}</td>
                    <td>
                        <button class="deleteBtn" data-id="${item.id}">Xoá</button>
                    </td>`;
                tbody.appendChild(row);
            });
        }

        function refreshTable() {
            getDataFromAPI(apiURL, function (err, data) {
                if (err) {
                    alert('Lỗi khi lấy dữ liệu từ API!');
                } else {
                    products = data;
                    renderTable(data);
                }
            });
        }

        // Khởi tạo bảng
        refreshTable();
    </script>
</body>

</html>